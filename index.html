<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUIZ DOS VELOSO - Painel do Operador</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --accent: #FFE66D;
            --purple: #A855F7;
            --blue: #3B82F6;
            --green: #22C55E;
            --orange: #F97316;
            --pink: #EC4899;
            --dark: #1E1B4B;
            --darker: #0F0D24;
            --light: #F8FAFC;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-mario: linear-gradient(135deg, #FF6B6B 0%, #FFE66D 50%, #4ECDC4 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--darker);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--light);
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: var(--darker);
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(78, 205, 196, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 107, 107, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(168, 85, 247, 0.1) 0%, transparent 40%);
            animation: bgPulse 15s ease-in-out infinite;
        }

        @keyframes bgPulse {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-5%, -5%) scale(1.1); }
        }

        /* Floating Stars */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .star {
            position: absolute;
            font-size: 20px;
            animation: floatStar 8s ease-in-out infinite;
            opacity: 0.6;
        }

        @keyframes floatStar {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.6; }
            50% { transform: translateY(-30px) rotate(180deg); opacity: 1; }
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header/Logo */
        .logo-container {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .logo {
            font-family: 'Fredoka One', cursive;
            font-size: 4rem;
            background: var(--gradient-mario);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 60px rgba(255, 107, 107, 0.5);
            animation: logoFloat 3s ease-in-out infinite;
            display: inline-block;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .logo-subtitle {
            font-size: 1.2rem;
            color: var(--accent);
            margin-top: 5px;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        /* Screen Management */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Setup Screen Layout */
        .setup-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        /* Cards */
        .card {
            background: linear-gradient(145deg, rgba(30, 27, 75, 0.9), rgba(15, 13, 36, 0.9));
            border-radius: 24px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .card-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            color: var(--light);
        }

        /* Question Count Selector */
        .question-count-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .count-btn {
            flex: 1;
            min-width: 80px;
            padding: 20px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-family: 'Fredoka One', cursive;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .count-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-mario);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .count-btn:hover {
            transform: translateY(-5px) scale(1.05);
            border-color: var(--accent);
            box-shadow: 0 10px 40px rgba(255, 230, 109, 0.3);
        }

        .count-btn.selected {
            background: var(--gradient-mario);
            border-color: transparent;
            transform: scale(1.05);
            box-shadow: 0 10px 40px rgba(255, 107, 107, 0.4);
        }

        .count-btn span {
            position: relative;
            z-index: 1;
        }

        /* Questions List */
        .questions-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 10px;
        }

        .questions-list::-webkit-scrollbar {
            width: 8px;
        }

        .questions-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .questions-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .question-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .question-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .question-number {
            width: 40px;
            height: 40px;
            background: var(--gradient-3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Fredoka One', cursive;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .question-text {
            flex: 1;
            font-size: 0.95rem;
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .question-actions {
            display: flex;
            gap: 8px;
        }

        .question-actions button {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-edit {
            background: var(--blue);
            color: white;
        }

        .btn-delete {
            background: var(--primary);
            color: white;
        }

        .question-actions button:hover {
            transform: scale(1.15);
        }

        /* Add Question Button */
        .btn-add-question {
            width: 100%;
            padding: 15px;
            border: 3px dashed rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            background: transparent;
            color: var(--light);
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-add-question:hover {
            border-color: var(--secondary);
            background: rgba(78, 205, 196, 0.1);
            transform: scale(1.02);
        }

        /* QR Code Section */
        .qr-section {
            text-align: center;
        }

        .qr-container {
            background: white;
            padding: 20px;
            border-radius: 20px;
            display: inline-block;
            margin: 20px 0;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        #qrcode {
            width: 200px;
            height: 200px;
        }

        #qrcode img {
            border-radius: 10px;
        }

        .qr-label {
            margin-top: 15px;
            font-size: 1.1rem;
            color: var(--accent);
            font-weight: 700;
        }

        /* Players Grid */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .player-card {
            text-align: center;
            padding: 15px 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            transition: all 0.3s;
            animation: playerJoin 0.5s ease;
        }

        @keyframes playerJoin {
            from { 
                opacity: 0; 
                transform: scale(0.5) rotate(-10deg); 
            }
            to { 
                opacity: 1; 
                transform: scale(1) rotate(0); 
            }
        }

        .player-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
        }

        .player-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin: 0 auto 10px;
            border: 3px solid var(--accent);
            object-fit: cover;
            background: var(--gradient-1);
        }

        .player-name {
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--light);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .player-count {
            text-align: center;
            padding: 15px;
            background: rgba(78, 205, 196, 0.2);
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .player-count-number {
            font-family: 'Fredoka One', cursive;
            font-size: 3rem;
            color: var(--secondary);
        }

        .player-count-label {
            font-size: 0.9rem;
            color: var(--light);
            opacity: 0.8;
        }

        /* Main Buttons */
        .btn-primary {
            width: 100%;
            padding: 20px 40px;
            border: none;
            border-radius: 20px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn-start {
            background: linear-gradient(135deg, var(--green), #10B981);
            color: white;
            box-shadow: 0 10px 40px rgba(34, 197, 94, 0.4);
        }

        .btn-start:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 60px rgba(34, 197, 94, 0.5);
        }

        .btn-start:disabled {
            background: #444;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-reset {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: linear-gradient(135deg, #DC2626, #B91C1C);
            color: white;
            border: none;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 100;
            box-shadow: 0 5px 20px rgba(220, 38, 38, 0.4);
        }

        .btn-reset:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(220, 38, 38, 0.5);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: linear-gradient(145deg, var(--dark), var(--darker));
            border-radius: 30px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 30px 100px rgba(0, 0, 0, 0.5);
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { 
                opacity: 0; 
                transform: scale(0.9) translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0); 
            }
        }

        .modal-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.8rem;
            margin-bottom: 25px;
            text-align: center;
            background: var(--gradient-mario);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--light);
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--secondary);
            background: rgba(255, 255, 255, 0.1);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        textarea.form-input {
            resize: vertical;
            min-height: 80px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option-label {
            width: 40px;
            height: 40px;
            background: var(--gradient-1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Fredoka One', cursive;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .option-item input[type="text"] {
            flex: 1;
        }

        .option-item input[type="radio"] {
            width: 24px;
            height: 24px;
            accent-color: var(--green);
            cursor: pointer;
        }

        .image-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-upload-area:hover {
            border-color: var(--secondary);
            background: rgba(78, 205, 196, 0.1);
        }

        .image-upload-area.has-image {
            padding: 10px;
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 12px;
            display: none;
        }

        .image-preview.visible {
            display: block;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-modal {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }

        .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-save {
            background: var(--gradient-3);
            color: white;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.4);
        }

        /* Game Screen */
        .game-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            min-height: calc(100vh - 200px);
        }

        .question-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .question-counter {
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 20px;
        }

        .progress-bar-container {
            width: 100%;
            max-width: 600px;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 40px;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-mario);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .current-question-text {
            font-family: 'Fredoka One', cursive;
            font-size: 2.5rem;
            line-height: 1.3;
            max-width: 900px;
            margin-bottom: 30px;
            color: var(--light);
        }

        .current-question-image {
            max-width: 500px;
            max-height: 350px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            display: none;
        }

        .current-question-image.visible {
            display: block;
        }

        .btn-next {
            padding: 20px 60px;
            background: linear-gradient(135deg, var(--purple), var(--pink));
            color: white;
            border: none;
            border-radius: 20px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 40px rgba(168, 85, 247, 0.4);
            margin-top: 30px;
        }

        .btn-next:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 60px rgba(168, 85, 247, 0.5);
        }

        /* Players Sidebar */
        .players-sidebar {
            background: rgba(30, 27, 75, 0.8);
            border-radius: 24px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.3rem;
            margin-bottom: 20px;
            text-align: center;
            color: var(--accent);
        }

        .game-players-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: calc(100vh - 350px);
            overflow-y: auto;
        }

        .game-player-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            transition: all 0.3s;
        }

        .game-player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent);
        }

        .game-player-info {
            flex: 1;
        }

        .game-player-name {
            font-weight: 700;
            font-size: 0.95rem;
        }

        .game-player-status {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--orange);
            animation: pulse 1.5s infinite;
        }

        .status-indicator.answered {
            background: var(--green);
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.9); }
        }

        /* Results Screen */
        .results-container {
            text-align: center;
            padding: 40px;
        }

        .results-title {
            font-family: 'Fredoka One', cursive;
            font-size: 3.5rem;
            margin-bottom: 50px;
            background: var(--gradient-mario);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: resultsBounce 0.8s ease;
        }

        @keyframes resultsBounce {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Podium */
        .podium-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin-bottom: 60px;
            min-height: 400px;
        }

        .podium-place {
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: podiumRise 1s ease forwards;
            opacity: 0;
        }

        .podium-place:nth-child(1) { animation-delay: 0.8s; }
        .podium-place:nth-child(2) { animation-delay: 0.4s; }
        .podium-place:nth-child(3) { animation-delay: 1.2s; }

        @keyframes podiumRise {
            from { 
                opacity: 0; 
                transform: translateY(100px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .podium-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        .podium-place:nth-child(2) .podium-avatar {
            width: 130px;
            height: 130px;
            border: 5px solid var(--accent);
        }

        .podium-name {
            font-family: 'Fredoka One', cursive;
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .podium-score {
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 15px;
        }

        .podium-stand {
            border-radius: 15px 15px 0 0;
            width: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Fredoka One', cursive;
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .podium-place:nth-child(1) .podium-stand {
            background: linear-gradient(180deg, #C0C0C0, #808080);
            height: 120px;
        }

        .podium-place:nth-child(2) .podium-stand {
            background: linear-gradient(180deg, #FFD700, #B8860B);
            height: 160px;
        }

        .podium-place:nth-child(3) .podium-stand {
            background: linear-gradient(180deg, #CD7F32, #8B4513);
            height: 80px;
        }

        /* Score Animation Bars */
        .score-bars-container {
            margin-bottom: 60px;
        }

        .score-bar-item {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            opacity: 0;
            animation: fadeInBar 0.5s ease forwards;
        }

        @keyframes fadeInBar {
            to { opacity: 1; }
        }

        .score-bar-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .score-bar-info {
            width: 150px;
            text-align: left;
            flex-shrink: 0;
        }

        .score-bar-name {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .score-bar-wrapper {
            flex: 1;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .score-bar-fill {
            height: 100%;
            border-radius: 20px;
            width: 0;
            transition: width 2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 20px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.2rem;
            color: white;
        }

        /* Ranking Table */
        .ranking-table-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .ranking-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
        }

        .ranking-table th {
            text-align: left;
            padding: 15px 20px;
            font-family: 'Fredoka One', cursive;
            font-size: 1rem;
            color: var(--accent);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .ranking-table td {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
        }

        .ranking-table tr td:first-child {
            border-radius: 12px 0 0 12px;
        }

        .ranking-table tr td:last-child {
            border-radius: 0 12px 12px 0;
        }

        .ranking-position {
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            width: 50px;
        }

        .ranking-position.gold { color: #FFD700; }
        .ranking-position.silver { color: #C0C0C0; }
        .ranking-position.bronze { color: #CD7F32; }

        .ranking-player {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ranking-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .btn-new-game {
            margin-top: 50px;
            padding: 20px 60px;
            background: var(--gradient-mario);
            color: white;
            border: none;
            border-radius: 20px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 40px rgba(255, 107, 107, 0.4);
        }

        .btn-new-game:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 60px rgba(255, 107, 107, 0.5);
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            animation: confettiFall 4s linear forwards;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .setup-grid {
                grid-template-columns: 1fr;
            }

            .game-container {
                grid-template-columns: 1fr;
            }

            .players-sidebar {
                order: -1;
            }

            .game-players-list {
                flex-direction: row;
                flex-wrap: wrap;
                max-height: none;
            }

            .game-player-item {
                flex: 0 0 auto;
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 2.5rem;
            }

            .current-question-text {
                font-size: 1.5rem;
            }

            .podium-container {
                flex-wrap: wrap;
            }
        }

        /* Confirmation Modal */
        .confirm-modal-content {
            text-align: center;
        }

        .confirm-modal-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .confirm-modal-text {
            font-size: 1.2rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .confirm-input {
            margin-bottom: 20px;
        }

        .confirm-input input {
            text-align: center;
            font-size: 1.2rem;
        }

        /* Waiting Modal */
        .waiting-modal {
            text-align: center;
        }

        .waiting-list {
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .waiting-player {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 165, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .waiting-player img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="stars-container" id="starsContainer"></div>

    <div class="container">
        <!-- Logo -->
        <div class="logo-container">
            <h1 class="logo">‚≠ê QUIZ DOS VELOSO ‚≠ê</h1>
            <p class="logo-subtitle">Painel do Operador</p>
        </div>

        <!-- Setup Screen -->
        <div class="screen active" id="setupScreen">
            <div class="setup-grid">
                <div class="left-column">
                    <!-- Question Count -->
                    <div class="card" style="margin-bottom: 25px;">
                        <div class="card-header">
                            <div class="card-icon" style="background: var(--gradient-1);">üéØ</div>
                            <h2 class="card-title">Quantidade de Perguntas</h2>
                        </div>
                        <div class="question-count-selector">
                            <button class="count-btn" data-count="5"><span>5</span></button>
                            <button class="count-btn selected" data-count="10"><span>10</span></button>
                            <button class="count-btn" data-count="15"><span>15</span></button>
                            <button class="count-btn" data-count="20"><span>20</span></button>
                        </div>
                    </div>

                    <!-- Questions Management -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon" style="background: var(--gradient-2);">üìù</div>
                            <h2 class="card-title">Perguntas Cadastradas (<span id="questionsCount">0</span>)</h2>
                        </div>
                        <div class="questions-list" id="questionsList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìã</div>
                                <p>Nenhuma pergunta cadastrada</p>
                            </div>
                        </div>
                        <button class="btn-add-question" onclick="openQuestionModal()">
                            <span>‚ûï</span> ADICIONAR PERGUNTA
                        </button>
                    </div>
                </div>

                <div class="right-column">
                    <!-- QR Code -->
                    <div class="card qr-section" style="margin-bottom: 25px;">
                        <div class="card-header">
                            <div class="card-icon" style="background: var(--gradient-3);">üì±</div>
                            <h2 class="card-title">Escaneie para Jogar</h2>
                        </div>
                        <div class="qr-container">
                            <div id="qrcode"></div>
                        </div>
                        <p class="qr-label">üì∑ Aponte a c√¢mera aqui!</p>
                    </div>

                    <!-- Players -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon" style="background: linear-gradient(135deg, var(--orange), var(--pink));">üë•</div>
                            <h2 class="card-title">Jogadores</h2>
                        </div>
                        <div class="player-count">
                            <div class="player-count-number" id="playerCountNumber">0</div>
                            <div class="player-count-label">conectados</div>
                        </div>
                        <div class="players-grid" id="playersGrid">
                            <div class="empty-state" id="noPlayersMsg">
                                <div class="empty-state-icon">üéÆ</div>
                                <p>Aguardando jogadores...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Start Button -->
                    <button class="btn-primary btn-start" id="btnStartGame" disabled onclick="startGame()">
                        üöÄ INICIAR JOGO
                    </button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div class="screen" id="gameScreen">
            <div class="game-container">
                <div class="question-display">
                    <div class="question-counter" id="questionCounter">Pergunta 1 de 10</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar" style="width: 10%"></div>
                    </div>
                    <img class="current-question-image" id="currentQuestionImage" src="" alt="">
                    <h2 class="current-question-text" id="currentQuestionText">Carregando pergunta...</h2>
                    <button class="btn-next" id="btnNextQuestion" onclick="nextQuestion()">
                        PR√ìXIMA PERGUNTA ‚û°Ô∏è
                    </button>
                </div>
                <div class="players-sidebar">
                    <h3 class="sidebar-title">üéÆ Respostas</h3>
                    <div class="game-players-list" id="gamePlayersList"></div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div class="screen" id="resultsScreen">
            <div class="results-container">
                <h1 class="results-title">üèÜ RESULTADO FINAL üèÜ</h1>
                
                <!-- Score Bars Animation -->
                <div class="score-bars-container" id="scoreBarsContainer"></div>

                <!-- Podium -->
                <div class="podium-container" id="podiumContainer"></div>

                <!-- Full Ranking -->
                <div class="ranking-table-container">
                    <table class="ranking-table">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Jogador</th>
                                <th>Acertos</th>
                                <th>%</th>
                            </tr>
                        </thead>
                        <tbody id="rankingTableBody"></tbody>
                    </table>
                </div>

                <button class="btn-new-game" onclick="newGame()">
                    üéÆ NOVO JOGO
                </button>
            </div>
        </div>
    </div>

    <!-- Reset Button -->
    <button class="btn-reset" onclick="openResetModal()">üóëÔ∏è RESET TOTAL</button>

    <!-- Question Modal -->
    <div class="modal-overlay" id="questionModal">
        <div class="modal">
            <h2 class="modal-title">üìù Nova Pergunta</h2>
            <form id="questionForm">
                <input type="hidden" id="editingQuestionId">
                
                <div class="form-group">
                    <label class="form-label">Texto da Pergunta</label>
                    <textarea class="form-input" id="questionText" placeholder="Digite a pergunta..." required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Imagem (opcional)</label>
                    <div class="image-upload-area" id="imageUploadArea" onclick="document.getElementById('questionImage').click()">
                        <input type="file" id="questionImage" accept="image/*" style="display: none;" onchange="previewImage(this)">
                        <img class="image-preview" id="imagePreview" src="" alt="">
                        <div id="uploadPlaceholder">
                            <div style="font-size: 3rem; margin-bottom: 10px;">üì∑</div>
                            <p>Clique para adicionar imagem</p>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Op√ß√µes de Resposta (marque a correta)</label>
                    <div class="options-grid">
                        <div class="option-item">
                            <div class="option-label">A</div>
                            <input type="text" class="form-input" id="optionA" placeholder="Op√ß√£o A" required>
                            <input type="radio" name="correct" value="0" required>
                        </div>
                        <div class="option-item">
                            <div class="option-label">B</div>
                            <input type="text" class="form-input" id="optionB" placeholder="Op√ß√£o B" required>
                            <input type="radio" name="correct" value="1">
                        </div>
                        <div class="option-item">
                            <div class="option-label">C</div>
                            <input type="text" class="form-input" id="optionC" placeholder="Op√ß√£o C" required>
                            <input type="radio" name="correct" value="2">
                        </div>
                        <div class="option-item">
                            <div class="option-label">D</div>
                            <input type="text" class="form-input" id="optionD" placeholder="Op√ß√£o D" required>
                            <input type="radio" name="correct" value="3">
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-modal btn-cancel" onclick="closeQuestionModal()">Cancelar</button>
                    <button type="submit" class="btn-modal btn-save">üíæ Salvar Pergunta</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal-overlay" id="resetModal">
        <div class="modal">
            <div class="confirm-modal-content">
                <div class="confirm-modal-icon">‚ö†Ô∏è</div>
                <h2 class="modal-title">Reset Total</h2>
                <p class="confirm-modal-text">
                    Isso ir√° <strong>apagar permanentemente</strong> todas as perguntas, jogadores e configura√ß√µes.<br><br>
                    Digite <strong>CONFIRMAR</strong> para continuar:
                </p>
                <div class="confirm-input">
                    <input type="text" class="form-input" id="confirmResetInput" placeholder="Digite CONFIRMAR">
                </div>
                <div class="modal-actions">
                    <button class="btn-modal btn-cancel" onclick="closeResetModal()">Cancelar</button>
                    <button class="btn-modal btn-save" style="background: linear-gradient(135deg, #DC2626, #B91C1C);" onclick="confirmReset()">üóëÔ∏è Apagar Tudo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Waiting Players Modal -->
    <div class="modal-overlay" id="waitingModal">
        <div class="modal">
            <div class="waiting-modal">
                <div class="confirm-modal-icon">‚è≥</div>
                <h2 class="modal-title">Jogadores Aguardando</h2>
                <p class="confirm-modal-text">
                    Os seguintes jogadores ainda n√£o responderam:
                </p>
                <div class="waiting-list" id="waitingPlayersList"></div>
                <div class="modal-actions">
                    <button class="btn-modal btn-cancel" onclick="closeWaitingModal()">Aguardar</button>
                    <button class="btn-modal btn-save" onclick="forceNextQuestion()">Continuar Mesmo Assim ‚û°Ô∏è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confetti Container -->
    <div class="confetti-container" id="confettiContainer"></div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, push, remove, onValue, update, off } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL, deleteObject, listAll } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBWAF9DYI8IFuKSG2tMhFYhDtXcyQI_QoQ",
            authDomain: "quiz-dos-veloso.firebaseapp.com",
            databaseURL: "https://quiz-dos-veloso-default-rtdb.firebaseio.com",
            projectId: "quiz-dos-veloso",
            storageBucket: "quiz-dos-veloso.firebasestorage.app",
            messagingSenderId: "374643522848",
            appId: "1:374643522848:web:221c5f84de4c6bec1a6b45"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);

        // Global State
        let questions = {};
        let players = {};
        let currentAnswers = {};
        let totalQuestions = 10;
        let currentQuestionIndex = 0;
        let questionKeys = [];

        // Generate QR Code
        function generateQRCode() {
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            // Get the base URL for GitHub Pages compatibility
            const currentUrl = window.location.href;
            const baseUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/') + 1);
            const mobileUrl = baseUrl + 'mobile-jogador.html';
            
            new QRCode(qrContainer, {
                text: mobileUrl,
                width: 200,
                height: 200,
                colorDark: "#1E1B4B",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // Create floating stars
        function createStars() {
            const container = document.getElementById('starsContainer');
            const stars = ['‚≠ê', '‚ú®', 'üåü', 'üí´'];
            
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = stars[Math.floor(Math.random() * stars.length)];
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 8 + 's';
                star.style.fontSize = (Math.random() * 15 + 15) + 'px';
                container.appendChild(star);
            }
        }

        // Question Count Selector
        document.querySelectorAll('.count-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.count-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                totalQuestions = parseInt(this.dataset.count);
                update(ref(db, 'config'), { totalQuestions: totalQuestions });
                updateStartButton();
            });
        });

        // Load Questions
        function loadQuestions() {
            onValue(ref(db, 'questions'), (snapshot) => {
                questions = snapshot.val() || {};
                renderQuestionsList();
                updateStartButton();
            });
        }

        // Render Questions List
        function renderQuestionsList() {
            const list = document.getElementById('questionsList');
            const count = document.getElementById('questionsCount');
            const keys = Object.keys(questions);
            
            count.textContent = keys.length;
            
            if (keys.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>Nenhuma pergunta cadastrada</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = keys.map((key, index) => `
                <div class="question-item">
                    <div class="question-number">${index + 1}</div>
                    <div class="question-text">${questions[key].text}</div>
                    <div class="question-actions">
                        <button class="btn-edit" onclick="editQuestion('${key}')" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-delete" onclick="deleteQuestion('${key}')" title="Excluir">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // Load Players
        function loadPlayers() {
            onValue(ref(db, 'players'), (snapshot) => {
                players = snapshot.val() || {};
                renderPlayersGrid();
                renderGamePlayersList();
                updateStartButton();
            });
        }

        // Render Players Grid (Setup Screen)
        function renderPlayersGrid() {
            const grid = document.getElementById('playersGrid');
            const countNumber = document.getElementById('playerCountNumber');
            const noPlayersMsg = document.getElementById('noPlayersMsg');
            const keys = Object.keys(players);
            
            countNumber.textContent = keys.length;
            
            if (keys.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" id="noPlayersMsg">
                        <div class="empty-state-icon">üéÆ</div>
                        <p>Aguardando jogadores...</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = keys.map(key => `
                <div class="player-card">
                    <img class="player-avatar" src="${players[key].photo || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%234ECDC4%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2260%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22>üë§</text></svg>'}" alt="">
                    <div class="player-name">${players[key].name}</div>
                </div>
            `).join('');
        }

        // Render Game Players List (Game Screen)
        function renderGamePlayersList() {
            const list = document.getElementById('gamePlayersList');
            const keys = Object.keys(players);
            
            list.innerHTML = keys.map(key => `
                <div class="game-player-item" id="player-${key}">
                    <img class="game-player-avatar" src="${players[key].photo || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%234ECDC4%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2260%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22>üë§</text></svg>'}" alt="">
                    <div class="game-player-info">
                        <div class="game-player-name">${players[key].name}</div>
                        <div class="game-player-status">Aguardando...</div>
                    </div>
                    <div class="status-indicator" id="status-${key}"></div>
                </div>
            `).join('');
        }

        // Listen to Current Answers
        function listenToAnswers() {
            onValue(ref(db, 'currentAnswers'), (snapshot) => {
                currentAnswers = snapshot.val() || {};
                updatePlayerStatuses();
            });
        }

        // Update Player Status Indicators
        function updatePlayerStatuses() {
            Object.keys(players).forEach(playerId => {
                const statusEl = document.getElementById(`status-${playerId}`);
                const playerItem = document.getElementById(`player-${playerId}`);
                
                if (statusEl && playerItem) {
                    if (currentAnswers[playerId] !== undefined) {
                        statusEl.classList.add('answered');
                        playerItem.querySelector('.game-player-status').textContent = 'Respondeu! ‚úì';
                    } else {
                        statusEl.classList.remove('answered');
                        playerItem.querySelector('.game-player-status').textContent = 'Aguardando...';
                    }
                }
            });
        }

        // Update Start Button State
        function updateStartButton() {
            const btn = document.getElementById('btnStartGame');
            const questionsCount = Object.keys(questions).length;
            const playersCount = Object.keys(players).length;
            
            btn.disabled = questionsCount === 0 || playersCount === 0;
            
            if (questionsCount === 0) {
                btn.textContent = 'üìù Adicione perguntas primeiro';
            } else if (playersCount === 0) {
                btn.textContent = 'üë• Aguardando jogadores...';
            } else {
                btn.textContent = `üöÄ INICIAR JOGO (${playersCount} jogadores)`;
            }
        }

        // Question Modal Functions
        window.openQuestionModal = function(questionId = null) {
            document.getElementById('questionModal').classList.add('active');
            document.getElementById('questionForm').reset();
            document.getElementById('editingQuestionId').value = '';
            document.getElementById('imagePreview').classList.remove('visible');
            document.getElementById('uploadPlaceholder').style.display = 'block';
            document.getElementById('imageUploadArea').classList.remove('has-image');
            
            if (questionId && questions[questionId]) {
                const q = questions[questionId];
                document.getElementById('editingQuestionId').value = questionId;
                document.getElementById('questionText').value = q.text;
                document.getElementById('optionA').value = q.options[0];
                document.getElementById('optionB').value = q.options[1];
                document.getElementById('optionC').value = q.options[2];
                document.getElementById('optionD').value = q.options[3];
                document.querySelector(`input[name="correct"][value="${q.correct}"]`).checked = true;
                
                if (q.image) {
                    document.getElementById('imagePreview').src = q.image;
                    document.getElementById('imagePreview').classList.add('visible');
                    document.getElementById('uploadPlaceholder').style.display = 'none';
                    document.getElementById('imageUploadArea').classList.add('has-image');
                }
            }
        };

        window.closeQuestionModal = function() {
            document.getElementById('questionModal').classList.remove('active');
        };

        window.editQuestion = function(questionId) {
            openQuestionModal(questionId);
        };

        window.deleteQuestion = async function(questionId) {
            if (confirm('Tem certeza que deseja excluir esta pergunta?')) {
                // Delete image from storage if exists
                if (questions[questionId]?.image) {
                    try {
                        const imageRef = storageRef(storage, `questions/${questionId}`);
                        await deleteObject(imageRef);
                    } catch (e) {
                        console.log('Image not found in storage');
                    }
                }
                await remove(ref(db, `questions/${questionId}`));
            }
        };

        window.previewImage = function(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('imagePreview').classList.add('visible');
                    document.getElementById('uploadPlaceholder').style.display = 'none';
                    document.getElementById('imageUploadArea').classList.add('has-image');
                };
                reader.readAsDataURL(input.files[0]);
            }
        };

        // Question Form Submit
        document.getElementById('questionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const questionId = document.getElementById('editingQuestionId').value || push(ref(db, 'questions')).key;
            const imageFile = document.getElementById('questionImage').files[0];
            
            let imageUrl = questions[questionId]?.image || '';
            
            // Upload image if new one selected
            if (imageFile) {
                const imageRefPath = storageRef(storage, `questions/${questionId}`);
                await uploadBytes(imageRefPath, imageFile);
                imageUrl = await getDownloadURL(imageRefPath);
            }
            
            const questionData = {
                text: document.getElementById('questionText').value,
                options: [
                    document.getElementById('optionA').value,
                    document.getElementById('optionB').value,
                    document.getElementById('optionC').value,
                    document.getElementById('optionD').value
                ],
                correct: parseInt(document.querySelector('input[name="correct"]:checked').value),
                image: imageUrl
            };
            
            await set(ref(db, `questions/${questionId}`), questionData);
            closeQuestionModal();
        });

        // Start Game
        window.startGame = async function() {
            questionKeys = Object.keys(questions);
            
            // Shuffle questions and limit to selected count
            questionKeys = questionKeys.sort(() => Math.random() - 0.5).slice(0, totalQuestions);
            currentQuestionIndex = 0;
            
            // Reset player scores
            for (const playerId of Object.keys(players)) {
                await update(ref(db, `players/${playerId}`), {
                    score: 0,
                    answers: []
                });
            }
            
            // Update config
            await update(ref(db, 'config'), {
                gameStarted: true,
                gameEnded: false,
                currentQuestion: 0,
                totalQuestions: questionKeys.length,
                questionOrder: questionKeys
            });
            
            // Clear current answers
            await set(ref(db, 'currentAnswers'), null);
            
            // Show game screen
            showScreen('gameScreen');
            displayCurrentQuestion();
        };

        // Display Current Question
        function displayCurrentQuestion() {
            if (currentQuestionIndex >= questionKeys.length) {
                endGame();
                return;
            }
            
            const questionKey = questionKeys[currentQuestionIndex];
            const question = questions[questionKey];
            
            document.getElementById('questionCounter').textContent = 
                `Pergunta ${currentQuestionIndex + 1} de ${questionKeys.length}`;
            document.getElementById('progressBar').style.width = 
                `${((currentQuestionIndex + 1) / questionKeys.length) * 100}%`;
            document.getElementById('currentQuestionText').textContent = question.text;
            
            const imageEl = document.getElementById('currentQuestionImage');
            if (question.image) {
                imageEl.src = question.image;
                imageEl.classList.add('visible');
            } else {
                imageEl.classList.remove('visible');
            }
            
            // Update Firebase
            update(ref(db, 'config'), {
                currentQuestion: currentQuestionIndex,
                currentQuestionKey: questionKey
            });
            
            // Clear current answers for new question
            set(ref(db, 'currentAnswers'), null);
            
            // Reset player statuses
            renderGamePlayersList();
        }

        // Next Question
        window.nextQuestion = function() {
            // Check if all players answered
            const totalPlayers = Object.keys(players).length;
            const answeredPlayers = Object.keys(currentAnswers).length;
            
            if (answeredPlayers < totalPlayers) {
                // Show waiting modal
                showWaitingModal();
                return;
            }
            
            proceedToNextQuestion();
        };

        function showWaitingModal() {
            const waitingList = document.getElementById('waitingPlayersList');
            const waitingPlayers = Object.keys(players).filter(id => currentAnswers[id] === undefined);
            
            waitingList.innerHTML = waitingPlayers.map(id => `
                <div class="waiting-player">
                    <img src="${players[id].photo || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%234ECDC4%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2260%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22>üë§</text></svg>'}" alt="">
                    <span>${players[id].name}</span>
                </div>
            `).join('');
            
            document.getElementById('waitingModal').classList.add('active');
        }

        window.closeWaitingModal = function() {
            document.getElementById('waitingModal').classList.remove('active');
        };

        window.forceNextQuestion = function() {
            closeWaitingModal();
            proceedToNextQuestion();
        };

        function proceedToNextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= questionKeys.length) {
                endGame();
            } else {
                displayCurrentQuestion();
            }
        }

        // End Game
        async function endGame() {
            await update(ref(db, 'config'), {
                gameStarted: false,
                gameEnded: true
            });
            
            showScreen('resultsScreen');
            showResults();
        }

        // Show Results with Animation
        function showResults() {
            const playersList = Object.entries(players)
                .map(([id, player]) => ({
                    id,
                    name: player.name,
                    photo: player.photo,
                    score: player.score || 0
                }))
                .sort((a, b) => b.score - a.score);
            
            // Create confetti
            createConfetti();
            
            // Show score bars animation first
            const scoreBarsContainer = document.getElementById('scoreBarsContainer');
            const maxScore = questionKeys.length;
            const colors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#A855F7', '#3B82F6', '#22C55E', '#F97316', '#EC4899'];
            
            scoreBarsContainer.innerHTML = playersList.map((player, index) => `
                <div class="score-bar-item" style="animation-delay: ${index * 0.2}s">
                    <img class="score-bar-avatar" src="${player.photo || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%234ECDC4%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2260%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22>üë§</text></svg>'}" alt="">
                    <div class="score-bar-info">
                        <div class="score-bar-name">${player.name}</div>
                    </div>
                    <div class="score-bar-wrapper">
                        <div class="score-bar-fill" id="bar-${player.id}" style="background: linear-gradient(90deg, ${colors[index % colors.length]}, ${colors[(index + 1) % colors.length]})">
                            ${player.score}/${maxScore}
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Animate bars after a short delay
            setTimeout(() => {
                playersList.forEach(player => {
                    const bar = document.getElementById(`bar-${player.id}`);
                    if (bar) {
                        bar.style.width = `${Math.max(10, (player.score / maxScore) * 100)}%`;
                    }
                });
            }, 500);
            
            // Show podium after bars animation
            setTimeout(() => {
                showPodium(playersList);
            }, 3000);
            
            // Show ranking table
            showRankingTable(playersList);
        }

        function showPodium(playersList) {
            const podiumContainer = document.getElementById('podiumContainer');
            const top3 = playersList.slice(0, 3);
            
            // Reorder for podium display: 2nd, 1st, 3rd
            const podiumOrder = [top3[1], top3[0], top3[2]].filter(Boolean);
            
            podiumContainer.innerHTML = podiumOrder.map((player, index) => {
                const actualPosition = index === 0 ? 2 : index === 1 ? 1 : 3;
                return `
                    <div class="podium-place">
                        <img class="podium-avatar" src="${player?.photo || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%234ECDC4%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2260%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22>üë§</text></svg>'}" alt="">
                        <div class="podium-name">${player?.name || '-'}</div>
                        <div class="podium-score">${player?.score || 0} acertos</div>
                        <div class="podium-stand">${actualPosition}¬∫</div>
                    </div>
                `;
            }).join('');
        }

        function showRankingTable(playersList) {
            const tableBody = document.getElementById('rankingTableBody');
            const maxScore = questionKeys.length;
            
            tableBody.innerHTML = playersList.map((player, index) => {
                const positionClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                const percentage = maxScore > 0 ? Math.round((player.score / maxScore) * 100) : 0;
                
                return `
                    <tr>
                        <td><span class="ranking-position ${positionClass}">${index + 1}¬∫</span></td>
                        <td>
                            <div class="ranking-player">
                                <img class="ranking-avatar" src="${player.photo || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%234ECDC4%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2260%22 font-size=%2240%22 text-anchor=%22middle%22 fill=%22white%22>üë§</text></svg>'}" alt="">
                                <span>${player.name}</span>
                            </div>
                        </td>
                        <td>${player.score}/${maxScore}</td>
                        <td>${percentage}%</td>
                    </tr>
                `;
            }).join('');
        }

        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            container.innerHTML = '';
            
            const colors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#A855F7', '#3B82F6', '#22C55E', '#F97316', '#EC4899'];
            const shapes = ['‚ñ†', '‚óè', '‚ñ≤', '‚òÖ', '‚ô¶'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.fontSize = (Math.random() * 20 + 10) + 'px';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 3) + 's';
                container.appendChild(confetti);
            }
            
            // Clear confetti after animation
            setTimeout(() => {
                container.innerHTML = '';
            }, 6000);
        }

        // New Game
        window.newGame = async function() {
            // Reset config
            await update(ref(db, 'config'), {
                gameStarted: false,
                gameEnded: false,
                currentQuestion: 0
            });
            
            // Clear current answers
            await set(ref(db, 'currentAnswers'), null);
            
            // Reset player scores
            for (const playerId of Object.keys(players)) {
                await update(ref(db, `players/${playerId}`), {
                    score: 0,
                    answers: []
                });
            }
            
            currentQuestionIndex = 0;
            showScreen('setupScreen');
        };

        // Reset Functions
        window.openResetModal = function() {
            document.getElementById('resetModal').classList.add('active');
            document.getElementById('confirmResetInput').value = '';
        };

        window.closeResetModal = function() {
            document.getElementById('resetModal').classList.remove('active');
        };

        window.confirmReset = async function() {
            const input = document.getElementById('confirmResetInput').value;
            
            if (input !== 'CONFIRMAR') {
                alert('Digite CONFIRMAR para prosseguir');
                return;
            }
            
            try {
                // Delete all images from storage
                try {
                    const questionsStorageRef = storageRef(storage, 'questions');
                    const questionsFiles = await listAll(questionsStorageRef);
                    for (const file of questionsFiles.items) {
                        await deleteObject(file);
                    }
                } catch (e) {
                    console.log('No questions images to delete');
                }
                
                try {
                    const playersStorageRef = storageRef(storage, 'players');
                    const playersFiles = await listAll(playersStorageRef);
                    for (const file of playersFiles.items) {
                        await deleteObject(file);
                    }
                } catch (e) {
                    console.log('No player images to delete');
                }
                
                // Clear database
                await set(ref(db, 'questions'), null);
                await set(ref(db, 'players'), null);
                await set(ref(db, 'currentAnswers'), null);
                await set(ref(db, 'config'), {
                    totalQuestions: 10,
                    currentQuestion: 0,
                    gameStarted: false,
                    gameEnded: false
                });
                
                closeResetModal();
                showScreen('setupScreen');
                alert('Reset completo realizado com sucesso!');
                
            } catch (error) {
                console.error('Error during reset:', error);
                alert('Erro ao realizar reset: ' + error.message);
            }
        };

        // Screen Management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // Listen to game state changes
        function listenToGameState() {
            onValue(ref(db, 'config'), (snapshot) => {
                const config = snapshot.val() || {};
                
                if (config.gameEnded && document.getElementById('gameScreen').classList.contains('active')) {
                    // Game ended, show results
                    showScreen('resultsScreen');
                    questionKeys = config.questionOrder || [];
                    showResults();
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            createStars();
            generateQRCode();
            loadQuestions();
            loadPlayers();
            listenToAnswers();
            listenToGameState();
            
            // Initialize config if not exists
            get(ref(db, 'config')).then(snapshot => {
                if (!snapshot.exists()) {
                    set(ref(db, 'config'), {
                        totalQuestions: 10,
                        currentQuestion: 0,
                        gameStarted: false,
                        gameEnded: false
                    });
                }
            });
        });
    </script>

    <!-- QRCode.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</body>
</html>
